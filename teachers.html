<!DOCTYPE html>
<html lang="en">
<head>
<title>ENSTP - Teachers & Students</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="description" content="Course Project">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
<link href="plugins/fontawesome-free-5.0.1/css/fontawesome-all.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="styles/teachers_styles.css">
<link rel="stylesheet" type="text/css" href="styles/teachers_responsive.css">
<link rel="stylesheet" type="text/css" href="styles/main_styles.css">
<link rel="stylesheet" type="text/css" href="styles/responsive.css">
<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.carousel.css">
<link rel="stylesheet" type="text/css" href="plugins/OwlCarousel2-2.2.1/owl.theme.default.css">
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
/* Filtres et Stats */
.filter-section {
    background: #fff;
    padding: 22px;
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.04);
}

/* Teacher card image & card body tweaks */
.teacher .card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
    border-radius: 8px 8px 0 0;
}
.teacher .card-body { padding: 18px; }





.stat-card:nth-child(3) {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.stat-card:nth-child(4) {
    background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
}

.stat-card:hover {
    transform: translateY(-5px);
}

.stat-card .number {
    font-size: 36px;
    font-weight: bold;
    margin-bottom: 5px;
}

.stat-card .label {
    font-size: 14px;
    opacity: 0.9;
}

/* Loading Skeleton */
.skeleton {
    animation: skeleton-loading 1s linear infinite alternate;
}

@keyframes skeleton-loading {
    0% {
        background-color: #e0e0e0;
    }
    100% {
        background-color: #f0f0f0;
    }
}

.skeleton-card {
    height: 400px;
    border-radius: 10px;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 60px 20px;
}

.empty-state i {
    font-size: 80px;
    color: #ccc;
    margin-bottom: 20px;
}

.empty-state h3 {
    color: #666;
    margin-bottom: 10px;
}

.empty-state p {
    color: #999;
}

/* Card Enhancements */
.teacher .card {
    transition: all 0.3s;
    height: 100%;
}

.teacher .card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

.role-badge {
    display: inline-block;
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    margin-top: 10px;
}

.role-badge.professor {
    background: #e3f2fd;
    color: #1976d2;
}

.role-badge.student {
    background: #e8f5e9;
    color: #388e3c;
}

.user-info {
    padding: 10px 20px;
    background: #f8f9fa;
    border-radius: 10px;
    margin-top: 15px;
}

.user-info-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 8px 0;
    font-size: 14px;
    color: #666;
}

.user-info-item i {
    color: #ffb606;
    width: 20px;
}

/* UI tweaks */
.search-box{
    display:flex;
    align-items:center;
    gap:10px;
    margin-top:8px;
}
.search-box input{
    flex:1;
    padding:10px 14px;
    border-radius:8px;
    border:1px solid #e6e6e6;
    outline:none;
}
.filter-tab{cursor:pointer;padding:10px 16px;border-radius:8px;margin-right:8px;background:#fff;border:1px solid transparent}
.filter-tab.active{background:linear-gradient(135deg,#ffb606,#ff8f00);color:#fff;border-color:rgba(0,0,0,0.03);}
.home .home_content{background:rgba(0,0,0,0.45);padding:18px;border-radius:8px;display:inline-block}
.home .home_content h1{color:#fff;font-weight:700;margin:0}
.teacher .card{overflow:hidden;border-radius:10px}
.teacher .card .card-img-top{height:220px;object-fit:cover}

</style>
</head>
<body>

<div class="super_container">

	<!-- Header -->
	<header class="header d-flex flex-row">
		<div class="header_content d-flex flex-row align-items-center">
			<!-- Logo -->
			<div class="logo_container">
				<div class="logo">
					<img src="images/logo.png" alt="">
				</div>
			</div>

			<!-- Main Navigation -->
			<nav class="main_nav_container">
				<div class="main_nav">
					<ul class="main_nav_list">
						<li class="main_nav_item"><a href="index.html">home</a></li>
						<li class="main_nav_item"><a href="about.html">about us</a></li>
						<li class="main_nav_item"><a href="courses.html">courses</a></li>
						<li class="main_nav_item"><a href="elements.html">elements</a></li>
						<li class="main_nav_item"><a href="news_post.html">news</a></li>
						<li class="main_nav_item"><a href="teachers.html">teachers</a></li>
						<li class="main_nav_item"><a href="index.html">memoire</a></li>
						<li class="main_nav_item"><a href="admin1.html">Admin</a></li>
					</ul>
				</div>
			</nav>
		</div>
		<div class="header_side d-flex flex-row justify-content-center align-items-center">
			<img src="images/phone-call.svg" alt="">
			<span>(237) 222 23 09 44 / (237) 222 22 18 16</span>
		</div>

		<!-- Hamburger -->
		<div class="hamburger_container">
			<i class="fas fa-bars trans_200"></i>
		</div>
	</header>
	
	<!-- Menu -->
	<div class="menu_container menu_mm">
		<div class="menu_close_container">
			<div class="menu_close"></div>
		</div>

		<div class="menu_inner menu_mm">
			<div class="menu menu_mm">
				<ul class="menu_list menu_mm">
					<li class="menu_item menu_mm"><a href="index.html">Home</a></li>
					<li class="menu_item menu_mm"><a href="about.html">About us</a></li>
					<li class="menu_item menu_mm"><a href="courses.html">Courses</a></li>
					<li class="menu_item menu_mm"><a href="elements.html">elements</a></li>
					<li class="menu_item menu_mm"><a href="news_post.html">News</a></li>
						<li class="menu_item menu_mm"><a href="teachers.html">Teachers</a></li>
						<li class="menu_item menu_mm"><a href="index.html">Memoire</a></li>
						<li class="menu_social_item menu_mm"><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
						<li class="menu_social_item menu_mm"><a href="#"><i class="fab fa-instagram"></i></a></li>
						<li class="menu_social_item menu_mm"><a href="#"><i class="fab fa-facebook-f"></i></a></li>
						<li class="menu_social_item menu_mm"><a href="#"><i class="fab fa-twitter"></i></a></li>
					</ul>
				</div>

				<div class="menu_copyright menu_mm">Colorlib All rights reserved</div>
			</div>
		</div>
	</div>
	
	<!-- Home (hero carousel like index) -->
	<div class="home">
		<div class="hero_slider_container">
			<div class="hero_slider owl-carousel">
				<div class="hero_slide">
					<div class="hero_slide_background" style="background-image:url(images/slider_background.jpg);position:relative;"></div>
					<div class="hero_slide_content d-flex flex-column align-items-center justify-content-center text-center" style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(26,26,26,0.60);backdrop-filter:blur(2px);padding:0 1rem;">
						<h2 class="font-title" style="color:#ffb606;font-size:2.7rem;font-weight:800;text-shadow:0 2px 16px #000,0 1px 0 #ffb606;letter-spacing:0.03em;">Enseignants & Étudiants d'Excellence</h2>
						<p style="color:#fff;font-size:1.25rem;font-weight:500;text-shadow:0 1px 8px #000;max-width:650px;margin:1.2rem auto 0 auto;line-height:1.5;">Découvrez l'annuaire officiel de l'ENSTP : talents, expertises et parcours inspirants réunis pour bâtir l'avenir.</p>
					</div>
				</div>
				<div class="hero_slide">
					<div class="hero_slide_background" style="background-image:url(images/travaux2.jpeg);position:relative;"></div>
					<div class="hero_slide_content d-flex flex-column align-items-center justify-content-center text-center" style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(26,26,26,0.60);backdrop-filter:blur(2px);padding:0 1rem;">
						<h2 class="font-title" style="color:#ffb606;font-size:2.7rem;font-weight:800;text-shadow:0 2px 16px #000,0 1px 0 #ffb606;letter-spacing:0.03em;">Rejoignez la Communauté ENSTP</h2>
						<p style="color:#fff;font-size:1.25rem;font-weight:500;text-shadow:0 1px 8px #000;max-width:650px;margin:1.2rem auto 0 auto;line-height:1.5;">Partagez vos connaissances, développez votre réseau et accédez à des opportunités uniques au sein de notre institution.</p>
					</div>
				</div>
				<div class="hero_slide">
					<div class="hero_slide_background" style="background-image:url(images/slider_background.jpg);position:relative;"></div>
					<div class="hero_slide_content d-flex flex-column align-items-center justify-content-center text-center" style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(26,26,26,0.60);backdrop-filter:blur(2px);padding:0 1rem;">
						<h2 class="font-title" style="color:#ffb606;font-size:2.7rem;font-weight:800;text-shadow:0 2px 16px #000,0 1px 0 #ffb606;letter-spacing:0.03em;">Innovation & Savoir-Faire</h2>
						<p style="color:#fff;font-size:1.25rem;font-weight:500;text-shadow:0 1px 8px #000;max-width:650px;margin:1.2rem auto 0 auto;line-height:1.5;">L’ENSTP valorise l’excellence académique et l’innovation pour former les leaders de demain dans le secteur des travaux publics.</p>
					</div>
				</div>
			</div>
			<div class="hero_slider_left hero_slider_nav trans_200"><span class="trans_200">prev</span></div>
			<div class="hero_slider_right hero_slider_nav trans_200"><span class="trans_200">next</span></div>
		</div>
		<div class="home_content">
			<h1>Teachers & Students</h1>
		</div>
	</div>

	<!-- Filter Section -->
	<div class="container" style="margin-top: 80px;">
		<div class="filter-section">
			<div class="filter-tabs">
				<div class="filter-tab active" data-filter="all">
					<i class="fas fa-users"></i> Tous
				</div>
				<div class="filter-tab" data-filter="professeur">
					<i class="fas fa-chalkboard-teacher"></i> Professeurs
				</div>
				<div class="filter-tab" data-filter="standard">
					<i class="fas fa-user-graduate"></i> Étudiants
				</div>
			</div>

			<div class="search-box">
				<input type="text" id="searchInput" placeholder="Rechercher par nom, email...">
				<i class="fas fa-search"></i>
			</div>

			<!-- Stats -->
			<div class="stats-grid" id="statsGrid">
				<div class="stat-card">
					<div class="number" id="totalCount">0</div>
					<div class="label">Total</div>
				</div>
				<div class="stat-card">
					<div class="number" id="profCount">0</div>
					<div class="label">Professeurs</div>
				</div>
				<div class="stat-card">
					<div class="number" id="studentCount">0</div>
					<div class="label">Étudiants</div>
				</div>
				<div class="stat-card">
					<div class="number" id="activeCount">0</div>
					<div class="label">Actifs ce mois</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Teachers & Students Grid -->
	<div class="teachers page_section">
		<div class="container">
			<div class="row" id="usersGrid">
				<!-- Loading Skeleton -->
				<div class="col-lg-4 teacher">
					<div class="skeleton skeleton-card"></div>
				</div>
				<div class="col-lg-4 teacher">
					<div class="skeleton skeleton-card"></div>
				</div>
				<div class="col-lg-4 teacher">
					<div class="skeleton skeleton-card"></div>
				</div>
			</div>

			<!-- Empty State -->
			<div class="empty-state" id="emptyState" style="display: none;">
				<i class="fas fa-user-slash"></i>
				<h3>Aucun résultat</h3>
				<p>Aucun utilisateur ne correspond à votre recherche</p>
			</div>
		</div>
	</div>

	<!-- Milestones -->
	<div class="milestones">
		<div class="milestones_background" style="background-image:url(images/milestones_background.jpg)"></div>

		<div class="container">
			<div class="row">
				
				<!-- Milestone -->
				<div class="col-lg-3 milestone_col">
					<div class="milestone text-center">
						<div class="milestone_icon"><img src="images/milestone_1.svg" alt=""></div>
						<div class="milestone_counter" data-end-value="0" id="milestone1">0</div>
						<div class="milestone_text">Étudiants inscrits</div>
					</div>
				</div>

				<!-- Milestone -->
				<div class="col-lg-3 milestone_col">
					<div class="milestone text-center">
						<div class="milestone_icon"><img src="images/milestone_2.svg" alt=""></div>
						<div class="milestone_counter" data-end-value="0" id="milestone2">0</div>
						<div class="milestone_text">Enseignants certifiés</div>
					</div>
				</div>

				<!-- Milestone -->
				<div class="col-lg-3 milestone_col">
					<div class="milestone text-center">
						<div class="milestone_icon"><img src="images/milestone_3.svg" alt=""></div>
						<div class="milestone_counter" data-end-value="0" id="milestone3">0</div>
						<div class="milestone_text">Cours validés</div>
					</div>
				</div>

				<!-- Milestone -->
				<div class="col-lg-3 milestone_col">
					<div class="milestone text-center">
						<div class="milestone_icon"><img src="images/milestone_4.svg" alt=""></div>
						<div class="milestone_counter" data-end-value="0" id="milestone4">0</div>
						<div class="milestone_text">Diplômés</div>
					</div>
				</div>

			</div>
		</div>
	</div>

	<!-- Become -->
	<div class="become">
		<div class="container">
			<div class="row row-eq-height">

				<div class="col-lg-6 order-2 order-lg-1">
					<div class="become_title">
						<h1>Become a teacher</h1>
					</div>
					<p class="become_text">In aliquam, augue a gravida rutrum, ante nisl fermentum nulla, vitae tempor nisl ligula vel nunc. Proin quis mi malesuada, finibus tortor fermentum. Etiam eu purus nec eros varius luctus. Praesent finibus risus facilisis ultricies venenatis. Suspendisse fermentum sodales lacus, lacinia gravida elit dapibus sed. Cras in lectus elit. Maecenas tempus nunc vitae mi egestas venenatis. Aliquam rhoncus, purus in vehicula porttitor, lacus ante consequat purus, id elementum enim purus nec enim. In sed odio rhoncus, tristique ipsum id, pharetra neque.</p>
					<div class="become_button text-center trans_200">
						<a href="#">Read More</a>
					</div>
				</div>

				<div class="col-lg-6 order-1 order-lg-2">
					<div class="become_image">
						<img src="images/become.jpg" alt="">
					</div>
				</div>
				
			</div>
		</div>
	</div>

	<!-- Footer -->
	<footer class="footer">
		<div class="container">
			
			<!-- Newsletter -->
			<div class="newsletter">
				<div class="row">
					<div class="col">
						<div class="section_title text-center">
							<h1>Upcoming Events</h1>
						</div>
					</div>
				</div>

				<div class="row">
					<div class="col text-center">
						<div class="newsletter_form_container mx-auto">
							<form action="post">
								<div class="newsletter_form d-flex flex-md-row flex-column flex-xs-column align-items-center justify-content-center">
									<input id="newsletter_email" class="newsletter_email" type="email" placeholder="Email Address" required="required" data-error="Valid email is required.">
									<button id="newsletter_submit" type="submit" class="newsletter_submit_btn trans_300" value="Submit">Subscribe</button>
								</div>
							</form>
						</div>
					</div>
				</div>

			</div>

			<!-- Footer Content -->
			<div class="footer_content">
				<div class="row">

					<!-- Footer Column - About -->
					<div class="col-lg-3 footer_col">
						<div class="logo_container">
							<div class="logo">
								<img src="images/logo.png" alt="">
							</div>
						</div>

						<p class="footer_about_text">In aliquam, augue a gravida rutrum, ante nisl fermentum nulla, vitae tempor nisl ligula vel nunc. Proin quis mi malesuada, finibus tortor fermentum, tempor lacus.</p>

					</div>

					<!-- Footer Column - Menu -->
					<div class="col-lg-3 footer_col">
						<div class="footer_column_title">Menu</div>
						<div class="footer_column_content">
							<ul>
								<li class="footer_list_item"><a href="index.html">Home</a></li>
								<li class="footer_list_item"><a href="about.html">About Us</a></li>
								<li class="footer_list_item"><a href="courses.html">Courses</a></li>
								<li class="footer_list_item"><a href="news_post.html">News</a></li>
								<li class="footer_list_item"><a href="contact.html">Contact</a></li>
							</ul>
						</div>
					</div>

					<!-- Footer Column - Usefull Links -->
					<div class="col-lg-3 footer_col">
						<div class="footer_column_title">Usefull Links</div>
						<div class="footer_column_content">
							<ul>
								<li class="footer_list_item"><a href="#">Testimonials</a></li>
								<li class="footer_list_item"><a href="#">FAQ</a></li>
								<li class="footer_list_item"><a href="#">Community</a></li>
								<li class="footer_list_item"><a href="#">Campus Pictures</a></li>
								<li class="footer_list_item"><a href="#">Tuitions</a></li>
							</ul>
						</div>
					</div>

					<!-- Footer Column - Contact -->
					<div class="col-lg-3 footer_col">
						<div class="footer_column_title">Contact</div>
						<div class="footer_column_content">
							<ul>
								<li class="footer_contact_item">
									<div class="footer_contact_icon">
										<img src="images/placeholder.svg" alt="">
									</div>
									Rue Elig-Effa Yaoundé-Cameroun
								</li>
								<li class="footer_contact_item">
									<div class="footer_contact_icon">
										<img src="images/smartphone.svg" alt="">
									</div>
									(237) 222 23 09 44 / (237) 222 22 18 16
								</li>
								<li class="footer_contact_item">
									<div class="footer_contact_icon">
										<img src="images/envelope.svg" alt="">
									</div>contact@enstp.cm
								</li>
							</ul>
						</div>
					</div>

				</div>
			</div>

			<!-- Footer Copyright -->
			<div class="footer_bar d-flex flex-column flex-sm-row align-items-center">
				<div class="footer_copyright">
					<span>Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="fa fa-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a></span>
				</div>
				<div class="footer_social ml-sm-auto">
					<ul class="menu_social">
						<li class="menu_social_item"><a href="#"><i class="fab fa-pinterest"></i></a></li>
						<li class="menu_social_item"><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
						<li class="menu_social_item"><a href="#"><i class="fab fa-instagram"></i></a></li>
						<li class="menu_social_item"><a href="#"><i class="fab fa-facebook-f"></i></a></li>
						<li class="menu_social_item"><a href="#"><i class="fab fa-twitter"></i></a></li>
					</ul>
				</div>
			</div>

		</div>
	</footer>

</div>

<script src="js/jquery-3.2.1.min.js"></script>
<script src="styles/bootstrap4/popper.js"></script>
<script src="styles/bootstrap4/bootstrap.min.js"></script>
<script src="plugins/greensock/TweenMax.min.js"></script>
<script src="plugins/greensock/TimelineMax.min.js"></script>
<script src="plugins/scrollmagic/ScrollMagic.min.js"></script>
<script src="plugins/greensock/animation.gsap.min.js"></script>
<script src="plugins/greensock/ScrollToPlugin.min.js"></script>
<script src="plugins/scrollTo/jquery.scrollTo.min.js"></script>
<script src="plugins/easing/easing.js"></script>
<script src="plugins/OwlCarousel2-2.2.1/owl.carousel.js"></script>
<script>
$(document).ready(function(){
    if($('.hero_slider').length){
        var owl = $('.hero_slider');
        owl.owlCarousel({
            items:1,
            loop:true,
            smartSpeed:800,
            autoplay:true,
            nav:false,
            dots:false
        });
        if($('.hero_slider_left').length){
            $('.hero_slider_left').on('click', function(){ owl.trigger('prev.owl.carousel'); });
        }
        if($('.hero_slider_right').length){
            $('.hero_slider_right').on('click', function(){ owl.trigger('next.owl.carousel'); });
        }
    }
});
</script>
<script src="js/teachers_custom.js"></script>

<script>
const CONFIG = {
    API_URL: 'https://mcb.reimca-app.com/api',
    UNIV_SLUG: 'ecole-des-travaux'
};

let allUsers = [];
let filteredUsers = [];
let currentFilter = 'all';

// Initialize
document.addEventListener('DOMContentLoaded', async () => {
    await loadUsers();
    setupEventListeners();
});

// Helpers: show alert banners with optional actions
function clearAlerts() {
    document.querySelectorAll('.page-alert').forEach(n => n.remove());
}

function showAlert(type, message, options = {}) {
    // type: 'danger' | 'warning' | 'info' | 'success'
    clearAlerts();
    const container = document.querySelector('.teachers .container') || document.body;
    const node = document.createElement('div');
    node.className = `page-alert alert alert-${type}`;
    node.style.marginBottom = '16px';
    node.innerHTML = `<span>${message}</span>`;

    const actions = document.createElement('div');
    actions.style.marginTop = '8px';

    if (options.showRetry) {
        const retryBtn = document.createElement('button');
        retryBtn.className = 'btn btn-sm btn-primary';
        retryBtn.textContent = 'Réessayer';
        retryBtn.addEventListener('click', () => { loadUsers(); });
        actions.appendChild(retryBtn);
    }

    if (options.showDemo) {
        const demoBtn = document.createElement('button');
        demoBtn.className = 'btn btn-sm btn-secondary';
        demoBtn.style.marginLeft = '8px';
        demoBtn.textContent = "Afficher des exemples";
        demoBtn.addEventListener('click', () => { setDemoUsers(); });
        actions.appendChild(demoBtn);
    }

    if (options.loginLink) {
        const loginA = document.createElement('a');
        loginA.className = 'btn btn-sm btn-outline-warning';
        loginA.style.marginLeft = '8px';
        loginA.href = 'register.html';
        loginA.textContent = 'Se connecter / s\'inscrire';
        actions.appendChild(loginA);
    }

    if (actions.childElementCount) node.appendChild(actions);
    container.prepend(node);
}

function setDemoUsers() {
    const demo = [
        { full_name: 'Jean Dupont', role: 'professeur', email: 'jean.dupont@example.com', photo_profil: 'images/teacher1.jpg', sexe: 'M', date_joined: new Date().toISOString() },
        { full_name: 'Amina Touré', role: 'professeur', email: 'amina.toure@example.com', photo_profil: 'images/teacher2.jpg', sexe: 'F', date_joined: new Date().toISOString() },
        { full_name: 'Aliou N', role: 'standard', email: 'aliou@example.com', photo_profil: 'images/teacher3.jpg', sexe: 'M', date_joined: new Date().toISOString() }
    ];
    allUsers = demo;
    filteredUsers = demo;
    renderUsers();
    updateStats();
}

// Load users from API with better error handling and retry/demo fallback
async function loadUsers(retry = 0) {
    clearAlerts();
    try {
        const token = localStorage.getItem('authToken');
        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};

        const response = await fetch(`${CONFIG.API_URL}/auth/${CONFIG.UNIV_SLUG}/users/?ordering=-id`, {
            headers
        });

        if (!response.ok) {
            if (response.status === 401) {
                // Not authorized: suggest login and offer demo data
                showAlert('warning', "Accès restreint : connexion requise pour afficher la liste complète.", { showDemo: true, loginLink: true });
                setDemoUsers();
                return;
            }

            // For 4xx/5xx show server message and retry option
            const text = await response.text().catch(() => response.statusText || '');
            showAlert('danger', `Erreur serveur ${response.status}: ${text || response.statusText}`, { showRetry: true, showDemo: true });
            return;
        }

        const users = await response.json();

        // Fetch roles for each user (best-effort)
        const usersWithRoles = await Promise.all(users.map(async (user) => {
            try {
                const roleResponse = await fetch(
                    `${CONFIG.API_URL}/universites/auth/universities/${CONFIG.UNIV_SLUG}/user-role/${user.id}/`,
                    { headers }
                );

                if (roleResponse.ok) {
                    const roleData = await roleResponse.json();
                    return { ...user, role: roleData.role };
                }
            } catch (e) {
                console.error('Role fetch error:', e);
            }
            return { ...user, role: 'standard' };
        }));

        // Filter only students and professors
        allUsers = usersWithRoles.filter(u => u.role === 'standard' || u.role === 'professeur');
        filteredUsers = allUsers;

		renderUsers();
		// Charger les stats dynamiques après les users
		await loadDynamicStats();
		updateStats();
	// Charge dynamiquement les stats (cours, diplômés) depuis l'API
	async function loadDynamicStats() {
		// Utilise les mêmes endpoints que dashboard-analytics.js
		try {
			// Cours validés (si endpoint existe)
			const coursesResp = await fetch(`${CONFIG.API_URL}/auth/${CONFIG.UNIV_SLUG}/courses/`);
			if (coursesResp.ok) {
				window.coursesData = await coursesResp.json();
			}
		} catch (e) { window.coursesData = null; }
		try {
			// Mémoires (pour diplômés)
			const memoiresResp = await fetch(`${CONFIG.API_URL}/memoires/universites/${CONFIG.UNIV_SLUG}/memoires/`);
			if (memoiresResp.ok) {
				window.graduatesData = await memoiresResp.json();
			}
		} catch (e) { window.graduatesData = null; }
	}
    } catch (error) {
        console.error('Error loading users:', error);
        // Network error or other exception: allow retry and demo fallback
        showAlert('danger', 'Impossible de contacter le serveur. Vérifiez votre connexion.', { showRetry: true, showDemo: true, loginLink: true });
    }
}

// Render users grid
function renderUsers() {
	const grid = document.getElementById('usersGrid');
	const emptyState = document.getElementById('emptyState');

	if (filteredUsers.length === 0) {
		grid.innerHTML = '';
		emptyState.style.display = 'block';
		return;
	}

	emptyState.style.display = 'none';

	// Séparer les utilisateurs par rôle
	const admins = filteredUsers.filter(u => u.role === 'admin' || u.role === 'administrateur');
	const students = filteredUsers.filter(u => u.role === 'standard' || u.role === 'étudiant');
	const teachers = filteredUsers.filter(u => u.role === 'professeur' || u.role === 'enseignant');

	let html = '';
	if (admins.length) {
		html += `<div class="row mb-4"><div class="col-12"><h3 style="color:#ffb606;font-weight:800;">Administrateurs</h3></div></div>`;
		html += admins.map(user => createUserCard(user, 'admin')).join('');
	}
	if (students.length) {
		html += `<div class="row mb-4"><div class="col-12"><h3 style="color:#ffb606;font-weight:800;">Étudiants</h3></div></div>`;
		html += students.map(user => createUserCard(user, 'student')).join('');
	}
	if (teachers.length) {
		html += `<div class="row mb-4"><div class="col-12"><h3 style="color:#ffb606;font-weight:800;">Enseignants</h3></div></div>`;
		html += teachers.map(user => createUserCard(user, 'teacher')).join('');
	}
	grid.innerHTML = html;
}

// Create user card HTML
function createUserCard(user) {
	const photoUrl = user.photo_profil || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.full_name || user.nom)}&background=ffb606&color=fff&size=400`;
	let roleLabel = '';
	let roleClass = '';
	if (user.role === 'admin' || user.role === 'administrateur') {
		roleLabel = 'Administrateur';
		roleClass = 'admin';
	} else if (user.role === 'professeur' || user.role === 'enseignant') {
		roleLabel = 'Enseignant';
		roleClass = 'teacher';
	} else {
		roleLabel = 'Étudiant';
		roleClass = 'student';
	}
	const linkedinUrl = user.realisation_linkedin || user.linkedin || '#';
	const hasLinkedin = linkedinUrl !== '#';

	// Couleurs de la charte uniquement
	const cardBg = roleClass === 'admin' ? '#fff8e1' : (roleClass === 'teacher' ? '#e3f2fd' : '#fcfcfc');
	const borderColor = roleClass === 'admin' ? '#ffb606' : (roleClass === 'teacher' ? '#1976d2' : '#388e3c');
	const badgeBg = roleClass === 'admin' ? '#ffb606' : (roleClass === 'teacher' ? '#1976d2' : '#388e3c');
	const badgeColor = '#fff';

	return `
		<div class="col-lg-4 col-md-6 mb-4 teacher">
			<div class="card" style="background:${cardBg};border:2px solid ${borderColor};border-radius:18px;box-shadow:0 8px 32px rgba(26,26,26,0.07);">
				<div class="card_img" style="border-radius:16px 16px 0 0;overflow:hidden;">
					<img class="card-img-top trans_200" src="${photoUrl}" alt="${user.full_name || user.nom}" onerror="this.src='https://ui-avatars.com/api/?name=${encodeURIComponent(user.full_name || user.nom)}&background=ffb606&color=fff&size=400'" style="height:220px;object-fit:cover;">
				</div>
				<div class="card-body text-center" style="padding:18px;">
					<div class="card-title" style="font-weight:700;font-size:1.2rem;color:#1a1a1a;"><a href="#" style="color:#1a1a1a;">${user.full_name || `${user.prenom} ${user.nom}`}</a></div>
					<div class="role-badge" style="background:${badgeBg};color:${badgeColor};font-weight:700;font-size:0.9rem;border-radius:999px;padding:4px 18px;margin-top:10px;">${roleLabel}</div>
					<div class="user-info" style="background:#fff;border-radius:10px;margin-top:15px;padding:10px 0;">
						<div class="user-info-item" style="color:#888;font-size:0.97rem;margin:6px 0;"><i class="fas fa-envelope" style="color:#ffb606;width:20px;"></i> <span>${user.email}</span></div>
						${user.sexe ? `<div class="user-info-item" style="color:#888;font-size:0.97rem;margin:6px 0;"><i class="fas fa-${user.sexe === 'M' ? 'mars' : 'venus'}" style="color:#ffb606;width:20px;"></i> <span>${user.sexe === 'M' ? 'Homme' : 'Femme'}</span></div>` : ''}
						${user.date_joined ? `<div class="user-info-item" style="color:#888;font-size:0.97rem;margin:6px 0;"><i class="fas fa-calendar" style="color:#ffb606;width:20px;"></i> <span>Inscrit le ${new Date(user.date_joined).toLocaleDateString('fr-FR')}</span></div>` : ''}
					</div>
					<div class="teacher_social mt-2">
						<ul class="menu_social" style="display:flex;justify-content:center;gap:10px;">
							${hasLinkedin ? `<li class="menu_social_item"><a href="${linkedinUrl}" target="_blank" style="color:#ffb606;font-size:1.2rem;"><i class="fab fa-linkedin-in"></i></a></li>` : ''}
							<li class="menu_social_item"><a href="mailto:${user.email}" style="color:#ffb606;font-size:1.2rem;"><i class="fas fa-envelope"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	`;
}

// Update statistics
function updateStats() {
	const professors = allUsers.filter(u => u.role === 'professeur' || u.role === 'enseignant');
	const students = allUsers.filter(u => u.role === 'standard' || u.role === 'étudiant');
	const admins = allUsers.filter(u => u.role === 'admin' || u.role === 'administrateur');
	// Active this month (joined in last 30 days)
	const now = new Date();
	const thirtyDaysAgo = new Date();
	thirtyDaysAgo.setDate(now.getDate() - 30);
	const activeCount = allUsers.filter(u => u.date_joined && new Date(u.date_joined) > thirtyDaysAgo).length;

	// Cours validés (dynamique si API, sinon valeur fictive)
	let coursesCount = 0;
	if (window.coursesData && Array.isArray(window.coursesData)) {
		coursesCount = window.coursesData.length;
	} else {
		coursesCount = 39; // valeur par défaut
	}
	// Diplômés (dynamique si API, sinon valeur fictive)
	let graduatesCount = 0;
	if (window.graduatesData && Array.isArray(window.graduatesData)) {
		graduatesCount = window.graduatesData.length;
	} else {
		graduatesCount = 3500; // valeur par défaut
	}

	// Animate numbers
	animateNumber('totalCount', allUsers.length);
	animateNumber('profCount', professors.length + admins.length);
	animateNumber('studentCount', students.length);
	animateNumber('activeCount', activeCount);
	animateNumber('milestone1', students.length);
	animateNumber('milestone2', professors.length + admins.length);
	animateNumber('milestone3', coursesCount);
	animateNumber('milestone4', graduatesCount);
}

// Animate number counter
function animateNumber(id, target) {
    const element = document.getElementById(id);
    const duration = 1000;
    const start = 0;
    const increment = target / (duration / 16);
    let current = start;

    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            element.textContent = target;
            clearInterval(timer);
        } else {
            element.textContent = Math.floor(current);
        }
    }, 16);
}

// Setup event listeners
function setupEventListeners() {
    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            currentFilter = tab.dataset.filter;
            applyFilters();
        });
    });

    // Search
    document.getElementById('searchInput').addEventListener('input', (e) => {
        applyFilters(e.target.value);
    });
}

// Apply filters
function applyFilters(searchQuery = '') {
    filteredUsers = allUsers;

    // Filter by role
    if (currentFilter !== 'all') {
        filteredUsers = filteredUsers.filter(u => u.role === currentFilter);
    }

    // Filter by search
    if (searchQuery) {
        const query = searchQuery.toLowerCase();
        filteredUsers = filteredUsers.filter(u => 
            (u.full_name || '').toLowerCase().includes(query) ||
            (u.nom || '').toLowerCase().includes(query) ||
            (u.prenom || '').toLowerCase().includes(query) ||
            (u.email || '').toLowerCase().includes(query)
        );
    }

    renderUsers();
}
</script>

</body>
</html>